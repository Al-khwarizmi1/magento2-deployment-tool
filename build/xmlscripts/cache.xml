<?xml version="1.0" encoding="UTF-8"?>

<project name="Cache" basedir="../..">

    <target name="cache:clean:all"
            description="Clear all caches"
            depends="cache:magento:clean,
                cache:opcache:restart,
                cache:varnish:restart"
            hidden="true">

        <echo message="All Caches restarted"/>
    </target>

    <target name="cache:magento:clean"
            description="Clear magento cache"
            hidden="true">

        <property name="cache.magento.bin" value="${release.target}/${bin.magento}"/>
        <if>
            <available property="cache.magento.bin.available" file="${cache.magento.bin}"/>
            <then>
                <echo message="${cache.magento.bin} cache:clean"/>
                <exec command="${cache.magento.bin} cache:clean" checkreturn="true" logoutput="true" />
            </then>
            <else>
                <echo message="${cache.magento.bin} not available to execute cache:clean command"/>
            </else>
        </if>
    </target>

    <target name="cache:opcache:restart"
            description="clear OpCache"
            hidden="true"
            unless="skipRestartOpcache">

        <echo message="${command.opcache.restart}"/>
        <exec command="${command.opcache.restart}" logoutput="true" checkreturn="true"/>
    </target>

    <target name="cache:varnish:restart"
            description="clear Varnish"
            hidden="true"
            unless="skipRestartVarnish">

        <if>
            <istrue value="${varnish.installed}"/>
            <then>
                <echo message="${command.varnish.restart}"/>
                <exec command="${command.varnish.restart}" logoutput="true" checkreturn="true"/>
            </then>
            <else>
                <echo message="Varnish not installed"/>
            </else>
        </if>
    </target>


</project>